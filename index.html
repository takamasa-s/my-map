<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€å¼·ãƒ©ãƒ¼ãƒ¡ãƒ³ãƒãƒƒãƒ—</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        html, body { height: 100%; margin: 0; display: flex; flex-direction: column; }
        #container { display: flex; flex: 1; overflow: hidden; }
        #sidebar { width: 300px; overflow-y: auto; background: white; border-right: 1px solid #ccc; padding: 10px; }
        #map { flex: 1; }
        .shop-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .shop-item:hover { background: #f0f0f0; }
        .rank { font-weight: bold; color: #e44; margin-right: 5px; }
        .stars { color: #f80; }
        @media (max-width: 600px) {
            #container { flex-direction: column-reverse; }
            #sidebar { width: 100%; height: 40%; border-right: none; border-top: 1px solid #ccc; }
        }
    </style>
</head>
<body>

<div id="container">
    <div id="sidebar">
        <h3>ğŸœ å‘¨è¾ºã®äººæ°—åº—</h3>
        <div id="shop-list"></div>
    </div>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map').setView([35.6812, 139.7671], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ¬æ¥ã¯APIã‹ã‚‰å–å¾—ã™ã‚‹éƒ¨åˆ†ï¼‰
    const shops = [
        { name: "éººå‡¦ ç©¶æ¥µ", lat: 35.6812, lng: 139.7671, rating: 4.8, reviews: 1250 },
        { name: "ã‚‰ãƒ¼ã‚ã‚“ æ˜‡é¾", lat: 35.6852, lng: 139.7701, rating: 4.5, reviews: 800 },
        { name: "æ¿ƒåšã¤ã‘éºº é ‚", lat: 35.6782, lng: 139.7601, rating: 4.2, reviews: 650 },
        { name: "ä¸­è¯ãã° å¹³å’Œ", lat: 35.6832, lng: 139.7631, rating: 3.9, reviews: 300 }
    ];

    const listEl = document.getElementById('shop-list');

    function updateList() {
        const bounds = map.getBounds();
        // 1. åœ°å›³ã®è¡¨ç¤ºç¯„å›²å†…ã«ã„ã‚‹åº—ã ã‘ã«çµã‚Šè¾¼ã‚€
        const visibleShops = shops.filter(shop => bounds.contains([shop.lat, shop.lng]));

        // 2. äººæ°—é †ï¼ˆè©•ä¾¡ãŒé«˜ã„é †ï¼‰ã«ä¸¦ã³æ›¿ãˆ
        visibleShops.sort((a, b) => b.rating - a.rating);

        // 3. ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        listEl.innerHTML = "";
        visibleShops.forEach((shop, index) => {
            const div = document.createElement('div');
            div.className = "shop-item";
            div.innerHTML = `<span class="rank">${index + 1}</span> <b>${shop.name}</b><br>
                             <span class="stars">â˜… ${shop.rating}</span> (${shop.reviews}ä»¶)`;
            div.onclick = () => map.panTo([shop.lat, shop.lng]);
            listEl.appendChild(div);

            // åœ°å›³ã«ãƒ”ãƒ³ã‚’ç«‹ã¦ã‚‹
            L.marker([shop.lat, shop.lng]).addTo(map).bindPopup(shop.name);
        });
    }

    // åœ°å›³ã‚’å‹•ã‹ã—ãŸæ™‚ã«ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹
    map.on('moveend', updateList);
    updateList(); // åˆå›å®Ÿè¡Œ
</script>
</body>
</html>
